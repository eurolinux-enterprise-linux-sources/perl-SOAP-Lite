------------------------------------------------------------------------
r365 | kutterma | 2010-04-27 20:58:52 +0200 (Ãšt, 27 dub 2010) | 1 line

- should fix UTF8 encoding bug (LWP::Content not bytes)
------------------------------------------------------------------------
Index: lib/SOAP/Transport/HTTP.pm
===================================================================
--- lib/SOAP/Transport/HTTP.pm	(revision 364)
+++ lib/SOAP/Transport/HTTP.pm	(revision 365)
@@ -197,10 +197,15 @@
           # from string (doing pack with 'C0A*' modifier) if length and
           # bytelength are not the same
             my $bytelength = SOAP::Utils::bytelength($envelope);
-            $envelope = pack( 'C0A*', $envelope )
-              if !$SOAP::Constants::DO_NOT_USE_LWP_LENGTH_HACK
-                  && length($envelope) != $bytelength;
-
+			if ($] < 5.008) {
+				$envelope = pack( 'C0A*', $envelope );
+			}
+			else {
+				require Encode;
+				$envelope = Encode::encode('UTF-8', $envelope); 
+			}
+            #  if !$SOAP::Constants::DO_NOT_USE_LWP_LENGTH_HACK
+            #      && length($envelope) != $bytelength;
             $http_request->content($envelope);
             $http_request->protocol('HTTP/1.1');
 
